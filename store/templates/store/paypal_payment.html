{% extends "store/base.html" %}


<title>
    {% block title %}
        Make Payment
    {% endblock title %}
</title>



{% block content %}
<div class="paypal-payment-container">
    <div class="paypal-table-contents">
        <h3 class="payment-detail">Payment Detail</h3>
        <div class="paypal-table">
          <ul class="table-header">
              <li>Product</li>
              <li>Quantity</li>
              <li>Price</li>
          </ul>
          {% for order in orders %}
          <ul class="table-data">
              <li>{{ order.basket.product.product_name|truncatechars:40 }}</li>
              <li>{{ order.basket.quantity }}</li>
              <li>${{ order.basket.product.price }}</li>
          </ul>
          {% endfor %}
        </div>
        <div class="paypal-contents">
            <h4>Total Items: <span>{{ total_items }}</span></h4>
            <h4>Sub Total: <span>${{ total_amount_due }}</span></h4>
            <a class="pay-later-button" href="{% url 'store:home' %}" type="button">Pay Later</a>
        </div>
    </div>
    <div class="paypal-button-container">
        <h3 class="payment-options">Payment Options</h3>
        <div id="paypal-button-container"></div>
        <!-- div id  container from paypal -->
    </div>
</div>




<script src="https://www.paypal.com/sdk/js?client-id=AWlUTXJ5Tv8HK1umtqCGzuATd8KK_WknE4mfnJCmSRlXI75do9dbzbnE18fKUW0p5aVHWFK0ps8rVxwh&currency=USD&locale=en_US"></script>
<script>
  paypal.Buttons({
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: "{{ total_amount_due }}"
          }
        }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert('Transaction completed by ' + details.payer.name.given_name);
        let url = "{% url 'store:order_complete' %}"
        window.location.href = url
      });
    }
  }).render('#paypal-button-container');
</script>
{% endblock content %}

